<html>
<head>
	<title>Map Quiz: wtr_mnts_e</title>
</head>
<body bgcolor="#FFFFFF" marginheight="0" marginwidth="0" topmargin="0" leftmargin="0">

<center>
    <img src="wtr_mnts_e.jpg" id="map" usemap="#img-map" border="0" style="z-index:0;">
	<map id="img-map" name="img-map"></map>
</center>

<div id="control-form"></div>
<center><font size="-1">Â© 2002 Lance Jenott (updated by Peter Verkinderen)</font></center>


<script language="Javascript">

	var arrayPos=0;
	var skipped = [];
	var found = [];
	var errors = [];

	var features = {
                'Altai Mnts.': {id: 1, coords: "218,53,228,70,277,86,294,92,295,64,280,43,260,33", shape: "poly"},
        'Amu Darya R.': {id: 2, coords: "13,116,24,117,39,127,47,131,59,147,74,156,76,164,64,165,47,151,32,135,12,121", shape: "poly"},
        'Aral Sea': {id: 3, coords: "32,86,22,86,16,92,10,102,12,109,19,108,29,110,32,104,39,100,32,92", shape: "poly"},
        'Lk. Balkash': {id: 4, coords: "136,87,149,82,183,82,184,88,176,91,150,91,147,101,138,104,134,97,127,87", shape: "poly"},
        'Lk. Baikal': {id: 5, coords: "430,10,418,24,400,36,383,39,383,49,413,49,426,38,445,22,445,7", shape: "poly"},
        'Ganges R.': {id: 6, coords: "171,232,179,232,192,245,208,256,230,257,252,258,263,267,275,273,276,280,264,279,251,268,230,266,215,267,209,268,191,257,177,245", shape: "poly"},
        'Himalayas': {id: 7, coords: "152,186,139,197,166,216,195,233,218,241,245,247,275,250,311,246,314,219,295,215,266,232,235,227,194,211,146,191", shape: "poly"},
        'Hindu Kush': {id: 8, coords: "92,174,59,179,45,191,50,200,72,210,78,214,86,223,103,225,105,207,125,187,125,173", shape: "poly"},
        'Indian Ocean': {id: 9, coords: "3,261,3,271,16,277,24,285,22,295,8,317,1,323,2,395,155,397,145,373,124,303,113,303,97,291,87,279,76,265", shape: "poly"},
        'Indus R.': {id: 10, coords: "122,193,129,193,122,204,117,227,117,237,97,253,95,273,86,268,86,258,86,243,107,228,113,203", shape: "poly"},
        'Lk. Issyk Kul': {id: 11, coords: "160,121,163,124,171,124,177,118,166,,118,159,120", shape: "poly"},
        'Karakorum': {id: 12, coords: "124,186,156,188,156,172,131,173", shape: "poly"},
        'Kun Lun Mnts.': {id: 13, coords: "158,152,159,168,204,178,236,166,236,161,205,165,167,158,154,150", shape: "poly"},
        'Lop Nor': {id: 14, coords: "264,131,274,131,275,143,275,148,265,151,262,150,261,139", shape: "poly"},
        'Pamirs': {id: 15, coords: "144,139,104,146,86,156,104,160,106,168,153,167", shape: "poly"},
        'Syr Darya R.': {id: 16, coords: "47,90,47,98,76,112,88,136,96,136,105,142,106,134,100,129,104,114,54,89", shape: "poly"},
        'Tarim R.': {id: 17, coords: "193, 134,192,140,217,142,229,139,244,,142,251,144,251,140,237,132,218,135,191,135", shape: "poly"},
        'Tien Shan Mnts.': {id: 18, coords: "152,135,155,145,187,139,199,132,247,127,259,121,257,110,245,109,186,121", shape: "poly"},
        'Yellow R.': {id: 19, coords: "379,169,390,169,398,157,409,147,410,136,424,129,453,135,453,148,450,160,448,171,447,178,476,178,509,159,511,164,499,170,483,185,475,187,451,187,439,187,438,176,442,151,446,142,419,141,408,163,396,173,379,173", shape: "poly"},
        'Yangtse R.': {id: 20, coords: "520,201,520,210,508,220,489,232,477,225,468,229,455,230,443,221,430,220,397,241,387,241,381,233,389,228,410,223,437,208,449,208,462,217,474,214,485,219,499,213,517,200", shape: "poly"},
	};
	let featureNamesShuffled = shuffleArray(Object.keys(features))

	document.onload = initialize();


	function initialize() {
		buildMap();
		buildForm();
	}


	function shuffleArray(array) {
		for (let i = array.length - 1; i > 0; i--) {
			const j = Math.floor(Math.random() * (i + 1));
			[array[i], array[j]] = [array[j], array[i]];
		}
		return array
	}

	function mapclick(clickedId) {
		let locationTofind = document.controls.locationTofind.value;
		let locationTofindID = features[locationTofind].id;

		if(clickedId==locationTofindID) {
			found.push(locationTofind);
			// remove the item from the skipped list, if it was there:
			skipped = skipped.filter((item) => item !== locationTofind);
			// move to the next quiz question:
			advance();
		} else {
			errors.push(locationTofind);
			buildForm();
			alert('Try Again');
		}
	}

	function skip() {
		let skippedTerm = document.controls.locationTofind.value;
		console.log("skipping", skippedTerm);
		if (!skipped.includes(skippedTerm)){
			skipped.push(skippedTerm);
		}
		console.log("You have now skipped "+ skipped.length + " places");
		
		advance()
	}

	function advance() {
		arrayPos++;
		if(arrayPos<featureNamesShuffled.length) {
			// If we are not at the end of our list of locations in the array 
			// then assign the current location to the "Find" box.
			buildForm()
			//document.controls.locationTofind.value = featureNamesShuffled[arrayPos]; 
			
		} else if (skipped.length > 0) {
			arrayPos = 0;
			featureNamesShuffled = shuffleArray(skipped);
			buildForm();
			alert('Finished; going back to the' + skipped.length + ' skipped places!')
			skipped = [];
		} else 	if (arrayPos==featureNamesShuffled.length) {
			// If we have come to the end of our locations list 
			// (the array) then notify the user with "Finished!".
			buildForm() // to display the correct number of 
			alert('Finished!'); 
		}
	}

	function buildMap() {
		// build the image map:
		let mapStr = "";
		for (const [name, d] of Object.entries(features)) {
		  mapStr += `<area shape="${d.shape}" coords="${d.coords}" solution="${name}" href="javascript:mapclick(${d.id});" title="">\n`
		  // NB: using `href=` turns the cursor into a pointed finger,
		  // while using `onclick=` keeps the cursor in the same shape.
		}

		// insert the image map into the document:
		document.getElementById("img-map").innerHTML = mapStr;
	}

	function buildForm(){
		console.log("BUILD THE FORM");


		let controlStr = `
		<center>
		<form name="controls">
		<font face="helvetica" size=+2">Find</font>
		&nbsp;
		<input type="text" name="locationTofind" value="${featureNamesShuffled[arrayPos]}" size="15" onFocus="this.blur();">
		<br>
		<input type="button" value="     Skip     " onClick="skip();">
		<input type="button" value="     Quit     " onClick="window.close();">
		<input type="button" value="Start Over" onClick="location.reload();">
		</form>
		<p>You have correctly identified ${found.length} of ${Object.keys(features).length} places (skipped ${skipped.length}, errors ${errors.length})</p>
		</center>
		`
		document.getElementById("control-form").innerHTML = controlStr;
	}



</script>


</body></html>